---
- hosts: ec2
  gather_facts: no
  tasks:
  
  - name: Uploads requirements.txt
    template:
      src: ../utils/requirements.txt
      dest: ~/requirements.txt

  - name: Install python dependencies
    pip:
      requirements: ~/requirements.txt
      executable: pip3.7
      extra_args: --user --no-cache

  - name: Upload script
    template:
      src: ../utils/streaming-data-mock.py
      dest: ~/streaming-script.py
  
  - name: Killing all previously running python3 scripts... (caution, might be dangerous)
    command: killall python3   

  - name: Run script 
    shell: cd ~; nohup python3 streaming-script.py </dev/null >/dev/null 2>&1 &
    